#include "routes.h"\n#include <string.h>\n#include <stdio.h>\n\n// ---- GET /api/health ----\nvoid handle_health(struct mg_connection *c, struct mg_http_message *hm) {\n    (void)hm;\n    mg_http_reply(c, 200,\n        "Content-Type: application/json\r\n"\n        "Access-Control-Allow-Origin: *\r\n",\n        "{\"status\": \"ok\"}\n");\n}\n\n// ---- Simple in-memory "items" store ----\n#define MAX_ITEMS 100\n#define MAX_ITEM_LEN 256\n\nstatic char items[MAX_ITEMS][MAX_ITEM_LEN];\nstatic int item_count = 0;\n\n// ---- GET & POST /api/items ----\nvoid handle_items(struct mg_connection *c, struct mg_http_message *hm) {\n    if (mg_strcmp(hm->method, mg_str("GET")) == 0) {\n        // Return all items as a JSON array\n        mg_printf(c,\n            "HTTP/1.1 200 OK\r\n"\n            "Content-Type: application/json\r\n"\n            "Access-Control-Allow-Origin: *\r\n"\n            "\r\n"\n            "[");\n        for (int i = 0; i < item_count; i++) {\n            mg_printf(c, "%s\"%s\"", (i > 0 ? "," : ""), items[i]);\n        }\n        mg_printf(c, "]\n");\n        c->is_resp = 0;  // Mark response as complete\n\n    } else if (mg_strcmp(hm->method, mg_str("POST")) == 0) {\n        // Parse JSON body: {\"name\": \"...\"}\n        char name[MAX_ITEM_LEN] = {0};\n        if (mg_json_get_str(hm->body, "$.name", name, sizeof(name)) <= 0) {\n            mg_http_reply(c, 400,\n                "Content-Type: application/json\r\n"\n                "Access-Control-Allow-Origin: *\r\n",\n                "{\"error\": \"Missing 'name' field\"}\n");\n            return;\n        }\n\n        if (item_count >= MAX_ITEMS) {\n            mg_http_reply(c, 507,\n                "Content-Type: application/json\r\n"\n                "Access-Control-Allow-Origin: *\r\n",\n                "{\"error\": \"Storage full\"}\n");\n            return;\n        }\n\n        strncpy(items[item_count], name, MAX_ITEM_LEN - 1);\n        item_count++;\n\n        mg_http_reply(c, 201,\n            "Content-Type: application/json\r\n"\n            "Access-Control-Allow-Origin: *\r\n",\n            "{\"message\": \"Item added\", \"name\": \"%s\"}\n", name);\n\n    } else if (mg_strcmp(hm->method, mg_str("OPTIONS")) == 0) {\n        // CORS preflight\n        mg_http_reply(c, 204,\n            "Access-Control-Allow-Origin: *\r\n"\n            "Access-Control-Allow-Methods: GET, POST, OPTIONS\r\n"\n            "Access-Control-Allow-Headers: Content-Type\r\n"\n            "", "");\n    } else {\n        mg_http_reply(c, 405,\n            "Content-Type: application/json\r\n",\n            "{\"error\": \"Method not allowed\"}\n");\n    }\n}